[gd_scene load_steps=22 format=3 uid="uid://ci6hsk3tl8qw6"]

[ext_resource type="Material" uid="uid://cpfv4dtvrm85w" path="res://assets/materials/floor_mat.tres" id="1_ebtfw"]
[ext_resource type="Material" uid="uid://bcaksjnqmlidl" path="res://assets/materials/wall_mat.tres" id="2_x3icv"]
[ext_resource type="PackedScene" uid="uid://wu130723yj4r" path="res://scenes/player/player.tscn" id="3_b20om"]
[ext_resource type="Script" path="res://scripts/camera_rig.gd" id="4_7t8jk"]
[ext_resource type="Script" path="res://scripts/player/headlight_togle.gd" id="4_8vwj6"]
[ext_resource type="Script" path="res://scripts/camera_3d_texel_snapped3.gd" id="4_cgcpi"]
[ext_resource type="Shader" path="res://assets/shaders/pixelart_stylizer.gdshader" id="4_oux1c"]
[ext_resource type="Shader" path="res://assets/shaders/pixel_art_upscale.gdshader" id="5_ybrq6"]
[ext_resource type="Script" path="res://scripts/display2.gd" id="6_7ti74"]
[ext_resource type="FontFile" uid="uid://cshtjebbbu45b" path="res://assets/fonts/ark-pixel-12px-monospaced-zh_cn.otf" id="9_pgmli"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_13x8q"]
sky_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)
ground_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)

[sub_resource type="Sky" id="Sky_n1bhg"]
sky_material = SubResource("ProceduralSkyMaterial_13x8q")

[sub_resource type="Environment" id="Environment_n8rq2"]
background_mode = 1
sky = SubResource("Sky_n1bhg")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="Animation" id="Animation_wjea1"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:light_energy")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [1.0]
}

[sub_resource type="Animation" id="Animation_2devf"]
resource_name = "flicker"
length = 5.0
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:light_energy")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.1, 1.2, 1.3, 1.6, 1.7, 1.9),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [1.0, 1.0, 0.764, 1.0, 1.0, 0.745, 1.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_d1h1v"]
_data = {
"RESET": SubResource("Animation_wjea1"),
"flicker": SubResource("Animation_2devf")
}

[sub_resource type="ShaderMaterial" id="ShaderMaterial_vaet3"]
render_priority = 0
shader = ExtResource("4_oux1c")
shader_parameter/shadows_enabled = true
shader_parameter/highlights_enabled = false
shader_parameter/shadow_strength = 0.4
shader_parameter/highlight_strength = 0.1
shader_parameter/highlight_color = Color(1, 1, 1, 1)
shader_parameter/shadow_color = Color(0, 0, 0, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_lkgup"]
material = SubResource("ShaderMaterial_vaet3")
size = Vector2(10, 8)

[sub_resource type="LabelSettings" id="LabelSettings_lllcc"]
font = ExtResource("9_pgmli")
font_size = 24
font_color = Color(1, 1, 1, 0.772549)
outline_size = 4
outline_color = Color(0, 0, 0, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_sdyh0"]
shader = ExtResource("5_ybrq6")

[sub_resource type="ViewportTexture" id="ViewportTexture_72lo0"]
viewport_path = NodePath("SubViewport")

[node name="world" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_n8rq2")

[node name="map" type="Node3D" parent="."]

[node name="wall&floor" type="Node" parent="map"]

[node name="floor" type="CSGBox3D" parent="map/wall&floor"]
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(10, 1, 10)

[node name="floor4" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 15, 0, -18)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(10, 1, 10)

[node name="floor2" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -12)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(2, 1, 14)

[node name="floor3" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.5, 0, -18)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(9, 1, 2)

[node name="wall1" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.5, 1.5, 0)
visible = false
layers = 2
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall2" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5.5, 1.5, 0)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall6" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.5, 1.5, -15)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall13" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 20.5, 1.5, -18)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall12" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.5, 1.5, -21.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 3)

[node name="wall10" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.5, 1.5, -12.5)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall11" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.5, 1.5, -23.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall8" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.5, 1.5, -19.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall3" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 0, 1.5, 5.5)
visible = false
layers = 2
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall4" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -3.5, 1.5, -5.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 5)

[node name="wall7" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -1.5, 1.5, -13)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(14, 4, 1)

[node name="wall5" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 3, 1.5, -5.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall9" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 5, 1.5, -11.5)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 8)

[node name="OmniLight3D" type="OmniLight3D" parent="map"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3.48807, 0)
layers = 3
shadow_enabled = true
omni_range = 8.81565

[node name="AnimationPlayer" type="AnimationPlayer" parent="map/OmniLight3D"]
libraries = {
"": SubResource("AnimationLibrary_d1h1v")
}
autoplay = "flicker"

[node name="SubViewport" type="SubViewport" parent="."]
handle_input_locally = false
size = Vector2i(484, 272)

[node name="player" parent="SubViewport" node_paths=PackedStringArray("camera_rig", "camera") instance=ExtResource("3_b20om")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
camera_rig = NodePath("../camera_rig")
camera = NodePath("../camera_rig/Camera3D")

[node name="visuals" parent="SubViewport/player" index="1" groups=["snap"]]

[node name="Skeleton3D" parent="SubViewport/player/visuals/female/Armature" index="0"]
bones/0/position = Vector3(-0.0661675, 1.97153, -86.7809)
bones/0/rotation = Quaternion(-0.57751, -0.00215698, 0.0455766, 0.815108)
bones/1/rotation = Quaternion(-0.044217, 0.0293715, -0.00188314, 0.998588)
bones/2/rotation = Quaternion(0.026958, 0.0199049, 0.00950527, 0.999393)
bones/3/rotation = Quaternion(0.0392051, 0.0202191, 0.01003, 0.998976)
bones/4/rotation = Quaternion(-0.0616404, -0.00291511, 0.0116202, 0.998027)
bones/5/rotation = Quaternion(-0.0888475, 0.0184369, -0.0284141, 0.995469)
bones/7/rotation = Quaternion(-0.552872, 0.51869, -0.527349, -0.383661)
bones/8/position = Vector3(-4.41284e-06, 10.8382, 1.16513e-05)
bones/8/rotation = Quaternion(0.311313, -0.233312, -0.211714, 0.896564)
bones/9/position = Vector3(4.52074e-06, 27.8415, 1.77641e-06)
bones/9/rotation = Quaternion(1.75596e-07, -7.25367e-08, -0.649059, 0.760738)
bones/10/position = Vector3(2.88822e-05, 28.3288, -1.89844e-06)
bones/10/rotation = Quaternion(-0.054282, 0.10518, -0.083518, 0.989452)
bones/11/position = Vector3(2.68185, 2.4648, 1.57397)
bones/11/rotation = Quaternion(0.198867, 0.0620908, -0.237479, 0.948789)
bones/12/position = Vector3(1.90735e-06, 4.18899, 7.11515e-06)
bones/12/rotation = Quaternion(-0.0494694, -0.0169214, 0.208919, 0.976534)
bones/13/rotation = Quaternion(-0.156321, -0.0119972, 0.0680513, 0.985286)
bones/14/position = Vector3(8.34465e-07, 2.57497, 2.44224e-07)
bones/15/position = Vector3(2.25985, 9.10828, 0.517848)
bones/15/rotation = Quaternion(0.453931, 0.00430546, 0.0275769, 0.8906)
bones/16/position = Vector3(2.91133e-07, 3.69999, 5.62467e-07)
bones/16/rotation = Quaternion(0.411911, 4.30062e-07, 0.0335583, 0.910606)
bones/17/position = Vector3(-6.47087e-08, 2.85001, 2.05763e-07)
bones/17/rotation = Quaternion(0.401085, -4.19139e-07, 0.0326753, 0.915458)
bones/19/position = Vector3(-1.52043e-05, 9.5325, 2.71781e-05)
bones/19/rotation = Quaternion(0.489046, 0.00912579, 0.0578439, 0.87029)
bones/20/position = Vector3(-9.95244e-06, 3.70001, -1.68239e-06)
bones/20/rotation = Quaternion(0.218942, 2.62621e-08, 0.0178372, 0.975575)
bones/21/rotation = Quaternion(0.207112, -3.42758e-07, 0.0168728, 0.978172)
bones/22/position = Vector3(-4.01207e-07, 2.94664, 1.32651e-06)
bones/23/position = Vector3(-1.86514, 9.1036, 0.043061)
bones/23/rotation = Quaternion(0.526484, -0.00597865, 0.0857888, 0.845825)
bones/24/rotation = Quaternion(0.492155, 2.40972e-07, 0.0400954, 0.869584)
bones/25/rotation = Quaternion(0.478414, -1.83658e-07, 0.0389752, 0.877269)
bones/26/position = Vector3(-7.42209e-07, 2.63881, 1.20608e-06)
bones/27/position = Vector3(-3.80628, 8.07667, 0.486689)
bones/27/rotation = Quaternion(0.540299, 0.0114993, 0.127946, 0.83161)
bones/28/position = Vector3(-3.01202e-08, 3.6, -2.13743e-06)
bones/28/rotation = Quaternion(0.518767, -3.48915e-08, 0.0422632, 0.853871)
bones/29/position = Vector3(2.35283e-06, 2.09998, -1.16476e-06)
bones/29/rotation = Quaternion(0.507404, -5.55057e-07, 0.041337, 0.860716)
bones/30/position = Vector3(-1.17017e-06, 2.11577, -4.388e-06)
bones/31/rotation = Quaternion(0.588159, 0.488324, -0.523041, 0.376878)
bones/32/position = Vector3(-4.76837e-07, 10.8377, -2.02153e-06)
bones/32/rotation = Quaternion(0.39041, 0.239833, 0.135331, 0.878491)
bones/33/rotation = Quaternion(3.56358e-07, -3.2582e-07, 0.600159, 0.799881)
bones/34/position = Vector3(6.12936e-06, 28.3288, 6.23057e-06)
bones/34/rotation = Quaternion(-0.0148657, -0.148494, 0.16027, 0.975726)
bones/35/position = Vector3(-2.68173, 2.46614, 1.5762)
bones/35/rotation = Quaternion(0.110859, -0.0637621, 0.261867, 0.956593)
bones/36/rotation = Quaternion(-0.048578, 0.0234045, -0.216652, 0.974759)
bones/37/position = Vector3(1.30834e-05, 3.4184, -4.19443e-06)
bones/37/rotation = Quaternion(-0.0930285, -0.0290661, 0.134019, 0.986174)
bones/38/position = Vector3(-3.24845e-06, 2.58058, -2.40185e-05)
bones/39/position = Vector3(-2.25986, 9.1093, 0.518035)
bones/39/rotation = Quaternion(0.687122, -0.0451212, 0.0119746, 0.72504)
bones/40/position = Vector3(6.09819e-06, 3.69999, -3.4346e-06)
bones/40/rotation = Quaternion(0.473464, -4.24643e-07, -0.0485186, 0.879476)
bones/41/position = Vector3(6.06033e-06, 2.85001, 2.90855e-06)
bones/41/rotation = Quaternion(0.399853, -6.85527e-07, -0.0409756, 0.915663)
bones/43/position = Vector3(-2.63118e-05, 9.53341, -3.27913e-05)
bones/43/rotation = Quaternion(0.693148, -0.0265265, -0.0731281, 0.716585)
bones/44/position = Vector3(2.93684e-07, 3.70001, -7.33839e-07)
bones/44/rotation = Quaternion(0.480527, -3.0633e-07, -0.0492424, 0.875596)
bones/45/rotation = Quaternion(0.404819, -1.2459e-06, -0.0414851, 0.913455)
bones/46/position = Vector3(-3.41319e-07, 2.95288, -2.20348e-06)
bones/47/position = Vector3(1.86509, 9.10453, 0.0430284)
bones/47/rotation = Quaternion(0.694767, -0.000648116, -0.0998803, 0.712266)
bones/48/position = Vector3(1.21889e-06, 3.15002, 2.89108e-07)
bones/48/rotation = Quaternion(0.492819, -6.6901e-07, -0.0505023, 0.868665)
bones/49/position = Vector3(-9.27795e-06, 2.94998, 5.48775e-06)
bones/49/rotation = Quaternion(0.403866, -1.27589e-06, -0.0413872, 0.913881)
bones/50/position = Vector3(-2.81585e-05, 2.64432, 1.55684e-05)
bones/51/position = Vector3(3.80627, 8.07778, 0.486877)
bones/51/rotation = Quaternion(0.714316, 0.0204894, -0.215512, 0.665498)
bones/52/position = Vector3(1.9315e-06, 3.59999, 3.07463e-06)
bones/52/rotation = Quaternion(0.497938, -1.32215e-06, -0.0510278, 0.86571)
bones/53/position = Vector3(-4.22686e-06, 2.10001, -1.5672e-07)
bones/53/rotation = Quaternion(0.415879, 4.0803e-07, -0.0426169, 0.908421)
bones/54/position = Vector3(-5.55534e-07, 2.12552, -8.40792e-06)
bones/55/rotation = Quaternion(-0.0285176, 0.354212, 0.934458, -0.0225488)
bones/56/rotation = Quaternion(-0.555783, 0.0104596, 0.0148412, 0.831129)
bones/57/rotation = Quaternion(0.744413, -0.0327251, -0.058629, 0.664335)
bones/58/rotation = Quaternion(0.335242, -1.01965e-08, -6.73578e-08, 0.942132)
bones/60/rotation = Quaternion(0.0392834, 0.480883, 0.875853, 0.00947266)
bones/61/rotation = Quaternion(-0.766346, 0.0450771, -0.0338916, 0.639949)
bones/62/rotation = Quaternion(0.456476, -0.0556081, 0.056229, 0.886214)
bones/63/rotation = Quaternion(0.315816, 2.81183e-08, -1.2184e-07, 0.948821)

[node name="Beta_Joints" parent="SubViewport/player/visuals/female/Armature/Skeleton3D" index="0"]
layers = 3

[node name="Beta_Surface" parent="SubViewport/player/visuals/female/Armature/Skeleton3D" index="1"]
layers = 3

[node name="AnimationPlayer" parent="SubViewport/player/visuals/female" index="1"]
autoplay = "idle"

[node name="OmniLight3D" type="OmniLight3D" parent="SubViewport/player/visuals" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.8, -0.5)
visible = false
layers = 2
light_energy = 0.2
light_cull_mask = 4293918722
omni_range = 1.0
script = ExtResource("4_8vwj6")

[node name="SpotLight3D" type="SpotLight3D" parent="SubViewport/player/visuals" index="2"]
transform = Transform3D(1, 0, 0, 0, 0.866025, 0.5, 0, -0.5, 0.866025, 0, 1.9, -0.2)
visible = false
spot_angle = 32.9
script = ExtResource("4_8vwj6")

[node name="camera_rig" type="Node3D" parent="SubViewport" node_paths=PackedStringArray("player")]
transform = Transform3D(0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 0, 1.7, 0)
script = ExtResource("4_7t8jk")
player = NodePath("../player")

[node name="Camera3D" type="Camera3D" parent="SubViewport/camera_rig"]
transform = Transform3D(1, 0, 0, 0, 0.707107, 0.707107, 0, -0.707107, 0.707106, 0, 6, 5)
projection = 1
current = true
size = 5.355
script = ExtResource("4_cgcpi")

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewport/camera_rig/Camera3D"]
transform = Transform3D(1, 0, 0, 0, -5.96046e-08, -1, 0, 1, 0, 9.53674e-07, -0.255379, -0.976128)
mesh = SubResource("PlaneMesh_lkgup")
skeleton = NodePath("../..")

[node name="Display" type="Control" parent="." node_paths=PackedStringArray("viewport")]
clip_contents = true
layout_mode = 3
anchor_right = 0.688
anchor_bottom = 0.704
offset_right = 599.04
offset_bottom = 319.68
script = ExtResource("6_7ti74")
viewport = NodePath("../SubViewport")

[node name="Label" type="Label" parent="Display"]
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -83.0
offset_top = -34.0
offset_right = 83.0
grow_horizontal = 2
grow_vertical = 0
text = "[WASD]-移动  [SHIFT]-冲刺  [空格]-开关手电  [鼠标右键]-瞄准"
label_settings = SubResource("LabelSettings_lllcc")

[node name="Sprite2D" type="Sprite2D" parent="Display"]
z_index = -1
texture_filter = 2
material = SubResource("ShaderMaterial_sdyh0")
texture = SubResource("ViewportTexture_72lo0")
centered = false

[editable path="SubViewport/player"]
[editable path="SubViewport/player/visuals/female"]
