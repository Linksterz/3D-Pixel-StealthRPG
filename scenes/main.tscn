[gd_scene load_steps=21 format=3 uid="uid://ci6hsk3tl8qw6"]

[ext_resource type="Material" uid="uid://cpfv4dtvrm85w" path="res://assets/materials/floor_mat.tres" id="1_ebtfw"]
[ext_resource type="Material" uid="uid://bcaksjnqmlidl" path="res://assets/materials/wall_mat.tres" id="2_x3icv"]
[ext_resource type="PackedScene" uid="uid://wu130723yj4r" path="res://scenes/player/player.tscn" id="3_b20om"]
[ext_resource type="Script" path="res://scripts/camera_rig.gd" id="4_7t8jk"]
[ext_resource type="Script" path="res://scripts/player/headlight_togle.gd" id="4_8vwj6"]
[ext_resource type="Script" path="res://scripts/camera_3d_texel_snapped3.gd" id="4_cgcpi"]
[ext_resource type="Shader" path="res://assets/shaders/pixelart_stylizer.gdshader" id="4_oux1c"]
[ext_resource type="Shader" path="res://assets/shaders/pixel_art_upscale.gdshader" id="5_ybrq6"]
[ext_resource type="Script" path="res://scripts/display2.gd" id="6_7ti74"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_13x8q"]
sky_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)
ground_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)

[sub_resource type="Sky" id="Sky_n1bhg"]
sky_material = SubResource("ProceduralSkyMaterial_13x8q")

[sub_resource type="Environment" id="Environment_n8rq2"]
background_mode = 1
sky = SubResource("Sky_n1bhg")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="Animation" id="Animation_wjea1"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:light_energy")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [1.0]
}

[sub_resource type="Animation" id="Animation_2devf"]
resource_name = "flicker"
length = 5.0
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:light_energy")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.1, 1.2, 1.3, 1.6, 1.7, 1.9),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [1.0, 1.0, 0.764, 1.0, 1.0, 0.745, 1.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_d1h1v"]
_data = {
"RESET": SubResource("Animation_wjea1"),
"flicker": SubResource("Animation_2devf")
}

[sub_resource type="ShaderMaterial" id="ShaderMaterial_vaet3"]
render_priority = 0
shader = ExtResource("4_oux1c")
shader_parameter/shadows_enabled = true
shader_parameter/highlights_enabled = false
shader_parameter/shadow_strength = 0.4
shader_parameter/highlight_strength = 0.1
shader_parameter/highlight_color = Color(1, 1, 1, 1)
shader_parameter/shadow_color = Color(0, 0, 0, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_lkgup"]
material = SubResource("ShaderMaterial_vaet3")
size = Vector2(10, 8)

[sub_resource type="LabelSettings" id="LabelSettings_lllcc"]
font_size = 24
outline_size = 4
outline_color = Color(0, 0, 0, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_sdyh0"]
shader = ExtResource("5_ybrq6")

[sub_resource type="ViewportTexture" id="ViewportTexture_72lo0"]
viewport_path = NodePath("SubViewport")

[node name="world" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_n8rq2")

[node name="map" type="Node3D" parent="."]

[node name="wall&floor" type="Node" parent="map"]

[node name="floor" type="CSGBox3D" parent="map/wall&floor"]
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(10, 1, 10)

[node name="floor4" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 15, 0, -18)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(10, 1, 10)

[node name="floor2" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -12)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(2, 1, 14)

[node name="floor3" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.5, 0, -18)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(9, 1, 2)

[node name="wall1" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.5, 1.5, 0)
visible = false
layers = 2
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall2" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5.5, 1.5, 0)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall6" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.5, 1.5, -15)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall13" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 20.5, 1.5, -18)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall12" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.5, 1.5, -21.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 3)

[node name="wall10" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.5, 1.5, -12.5)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall11" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.5, 1.5, -23.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall8" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.5, 1.5, -19.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall3" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 0, 1.5, 5.5)
visible = false
layers = 2
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall4" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -3.5, 1.5, -5.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 5)

[node name="wall7" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -1.5, 1.5, -13)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(14, 4, 1)

[node name="wall5" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 3, 1.5, -5.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall9" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 5, 1.5, -11.5)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 8)

[node name="OmniLight3D" type="OmniLight3D" parent="map"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3.48807, 0)
layers = 3
shadow_enabled = true
omni_range = 8.81565

[node name="AnimationPlayer" type="AnimationPlayer" parent="map/OmniLight3D"]
libraries = {
"": SubResource("AnimationLibrary_d1h1v")
}
autoplay = "flicker"

[node name="SubViewport" type="SubViewport" parent="."]
handle_input_locally = false
size = Vector2i(484, 272)

[node name="player" parent="SubViewport" node_paths=PackedStringArray("camera") instance=ExtResource("3_b20om")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
camera = NodePath("../camera_rig")

[node name="visuals" parent="SubViewport/player" index="1" groups=["snap"]]

[node name="Skeleton3D" parent="SubViewport/player/visuals/female/Armature" index="0"]
bones/0/position = Vector3(4.87046, 1.27523, -103.201)
bones/0/rotation = Quaternion(-0.705819, -0.046473, 0.0116286, 0.706771)
bones/1/rotation = Quaternion(-0.0695686, 0.0052431, 0.0151188, 0.997449)
bones/2/rotation = Quaternion(0.0212324, 0.00850472, 0.0272833, 0.999366)
bones/3/rotation = Quaternion(0.0341081, 0.00885556, 0.0271714, 0.999009)
bones/4/rotation = Quaternion(-0.0903359, 0.00203741, -0.00290118, 0.995905)
bones/5/rotation = Quaternion(0.0373617, 0.011217, -0.039098, 0.998474)
bones/7/rotation = Quaternion(-0.542437, 0.527468, -0.5413, -0.366789)
bones/8/position = Vector3(-1.04733e-06, 10.8382, -3.12109e-05)
bones/8/rotation = Quaternion(0.496798, -0.278884, -0.20874, 0.794886)
bones/9/position = Vector3(6.66651e-06, 27.8415, -7.76033e-06)
bones/9/rotation = Quaternion(0.000758072, 0.00866838, -0.0870955, 0.996162)
bones/10/position = Vector3(2.35774e-05, 28.3288, 7.24165e-07)
bones/10/rotation = Quaternion(-0.201886, 0.252912, -0.115185, 0.939154)
bones/11/rotation = Quaternion(0.201767, 0.149035, -0.104799, 0.962339)
bones/12/rotation = Quaternion(-0.0389447, -0.00928359, 0.129819, 0.990729)
bones/13/rotation = Quaternion(4.61435e-07, -0.000807556, 3.13501e-07, 1)
bones/15/position = Vector3(2.25983, 9.10827, 0.517858)
bones/15/rotation = Quaternion(0.119049, 0.064661, 0.0619185, 0.988844)
bones/16/rotation = Quaternion(0.0456396, -0.00014874, 0.00500763, 0.998945)
bones/17/rotation = Quaternion(8.10558e-06, -1.61364e-07, 6.33008e-08, 1)
bones/19/position = Vector3(-2.18916e-05, 9.53249, 3.43381e-05)
bones/19/rotation = Quaternion(0.119872, 0.00715704, 0.0534441, 0.991324)
bones/20/position = Vector3(-1.13552e-06, 3.70001, 1.49899e-06)
bones/20/rotation = Quaternion(0.0908427, 0.00042983, -0.00406, 0.995857)
bones/21/rotation = Quaternion(2.58754e-06, -1.5214e-07, 5.64614e-08, 1)
bones/23/rotation = Quaternion(0.176889, 0.0112047, 0.0336221, 0.983593)
bones/24/rotation = Quaternion(0.0815037, 0.00280029, -0.00414069, 0.996661)
bones/25/rotation = Quaternion(2.64022e-06, -4.05355e-08, -1.73248e-07, 1)
bones/26/position = Vector3(-2.81072e-07, 2.6388, 3.11877e-07)
bones/27/position = Vector3(-3.80628, 8.07666, 0.486695)
bones/27/rotation = Quaternion(0.193833, -0.00700996, 0.032533, 0.98047)
bones/28/rotation = Quaternion(0.108709, 0.00729878, -0.0364686, 0.993378)
bones/29/position = Vector3(1.63284e-06, 2.09997, -3.23089e-08)
bones/29/rotation = Quaternion(3.57677e-06, -2.75607e-07, -4.79631e-07, 1)
bones/31/rotation = Quaternion(0.568177, 0.504124, -0.539448, 0.363358)
bones/32/position = Vector3(2.54742e-06, 10.8377, 2.18272e-06)
bones/32/rotation = Quaternion(0.509537, 0.206382, 0.221912, 0.805316)
bones/33/rotation = Quaternion(0.000416529, -0.00559203, 0.0741901, 0.997228)
bones/34/rotation = Quaternion(-0.099344, -0.153684, 0.156917, 0.97051)
bones/35/position = Vector3(-2.68173, 2.46613, 1.5762)
bones/35/rotation = Quaternion(0.21738, -0.117753, 0.119661, 0.961541)
bones/36/rotation = Quaternion(-0.0486588, 0.0175979, -0.0928337, 0.994336)
bones/37/rotation = Quaternion(5.88579e-07, 0.000745094, -1.38799e-07, 1)
bones/39/position = Vector3(-2.25986, 9.10929, 0.518037)
bones/39/rotation = Quaternion(0.117828, -0.0682735, -0.0984822, 0.985777)
bones/40/position = Vector3(-1.5316e-06, 3.7, 4.314e-06)
bones/40/rotation = Quaternion(0.0989093, 0.0038301, -0.0101111, 0.995038)
bones/41/rotation = Quaternion(7.62116e-08, -1.15326e-07, -1.10886e-08, 1)
bones/43/position = Vector3(-3.79958e-05, 9.53338, -2.97961e-05)
bones/43/rotation = Quaternion(0.0925638, -0.0125438, -0.0593283, 0.993859)
bones/44/rotation = Quaternion(0.090175, 9.58334e-05, 0.0025508, 0.995923)
bones/45/rotation = Quaternion(-2.58437e-06, -2.37944e-07, -4.2887e-07, 1)
bones/47/position = Vector3(1.86508, 9.10452, 0.0430273)
bones/47/rotation = Quaternion(0.165805, 0.00705465, -0.059148, 0.984358)
bones/48/rotation = Quaternion(0.0906413, -0.000948565, -0.000930167, 0.995883)
bones/50/position = Vector3(-2.33936e-05, 2.64433, 1.24642e-05)
bones/51/position = Vector3(3.80626, 8.07777, 0.486884)
bones/51/rotation = Quaternion(0.243545, 0.0412232, -0.0726348, 0.966287)
bones/52/position = Vector3(2.40696e-06, 3.59999, 3.48082e-08)
bones/52/rotation = Quaternion(0.142264, -0.000800132, 0.0247541, 0.989519)
bones/53/position = Vector3(1.07736e-06, 2.10001, -3.70327e-06)
bones/53/rotation = Quaternion(7.27448e-06, 5.25845e-07, 5.37373e-07, 1)
bones/55/rotation = Quaternion(-0.0601135, 0.0346068, 0.996022, -0.0559361)
bones/56/rotation = Quaternion(-0.113765, -0.000160353, 0.00231191, 0.993505)
bones/57/rotation = Quaternion(0.495891, 0.0890564, -0.0715161, 0.860841)
bones/58/rotation = Quaternion(0.357823, -0.00780368, 0.00607017, 0.933737)
bones/60/rotation = Quaternion(0.0247029, 0.136752, 0.98763, -0.0726311)
bones/61/rotation = Quaternion(-0.160741, -0.000722069, -0.00460285, 0.986986)
bones/62/rotation = Quaternion(0.42661, -0.155558, 0.0386488, 0.890119)
bones/63/rotation = Quaternion(0.334418, -0.0217576, 0.0220681, 0.941915)

[node name="Beta_Joints" parent="SubViewport/player/visuals/female/Armature/Skeleton3D" index="0"]
layers = 3

[node name="Beta_Surface" parent="SubViewport/player/visuals/female/Armature/Skeleton3D" index="1"]
layers = 3

[node name="AnimationPlayer" parent="SubViewport/player/visuals/female" index="1"]
autoplay = "idle"

[node name="OmniLight3D" type="OmniLight3D" parent="SubViewport/player/visuals" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.8, -0.5)
visible = false
layers = 2
light_energy = 0.2
light_cull_mask = 4293918722
omni_range = 1.0
script = ExtResource("4_8vwj6")

[node name="SpotLight3D" type="SpotLight3D" parent="SubViewport/player/visuals" index="2"]
transform = Transform3D(1, 0, 0, 0, 0.866025, 0.5, 0, -0.5, 0.866025, 0, 1.9, -0.2)
visible = false
spot_angle = 32.9
script = ExtResource("4_8vwj6")

[node name="camera_rig" type="Node3D" parent="SubViewport" node_paths=PackedStringArray("player")]
transform = Transform3D(0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 0, 0, 0)
script = ExtResource("4_7t8jk")
player = NodePath("../player")
stage_dimentions = Vector2(600, 600)

[node name="Camera3D" type="Camera3D" parent="SubViewport/camera_rig"]
transform = Transform3D(1, 0, 0, 0, 0.707107, 0.707107, 0, -0.707107, 0.707106, 0, 8.24264, 7.24264)
projection = 1
current = true
size = 5.355
script = ExtResource("4_cgcpi")

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewport/camera_rig/Camera3D"]
transform = Transform3D(1, 0, 0, 0, -5.96046e-08, -1, 0, 1, 0, 9.53674e-07, -0.255379, -0.976128)
mesh = SubResource("PlaneMesh_lkgup")
skeleton = NodePath("../..")

[node name="Display" type="Control" parent="." node_paths=PackedStringArray("viewport")]
clip_contents = true
layout_mode = 3
anchor_right = 0.688
anchor_bottom = 0.704
offset_right = 599.04
offset_bottom = 319.68
script = ExtResource("6_7ti74")
viewport = NodePath("../SubViewport")

[node name="Label" type="Label" parent="Display"]
z_index = 1
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -83.0
offset_top = -34.0
offset_right = 83.0
grow_horizontal = 2
grow_vertical = 0
text = "[空格] 开关手电"
label_settings = SubResource("LabelSettings_lllcc")

[node name="Sprite2D" type="Sprite2D" parent="Display"]
texture_filter = 2
material = SubResource("ShaderMaterial_sdyh0")
texture = SubResource("ViewportTexture_72lo0")
centered = false

[editable path="SubViewport/player"]
[editable path="SubViewport/player/visuals/female"]
