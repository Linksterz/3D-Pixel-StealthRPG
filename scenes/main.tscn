[gd_scene load_steps=22 format=3 uid="uid://ci6hsk3tl8qw6"]

[ext_resource type="Material" uid="uid://cpfv4dtvrm85w" path="res://assets/materials/floor_mat.tres" id="1_ebtfw"]
[ext_resource type="Material" uid="uid://bcaksjnqmlidl" path="res://assets/materials/wall_mat.tres" id="2_x3icv"]
[ext_resource type="PackedScene" uid="uid://wu130723yj4r" path="res://scenes/player/player.tscn" id="3_b20om"]
[ext_resource type="Script" path="res://scripts/camera_rig.gd" id="4_7t8jk"]
[ext_resource type="Script" path="res://scripts/player/headlight_togle.gd" id="4_8vwj6"]
[ext_resource type="Script" path="res://scripts/camera_3d_texel_snapped3.gd" id="4_cgcpi"]
[ext_resource type="Shader" path="res://assets/shaders/pixelart_stylizer.gdshader" id="4_oux1c"]
[ext_resource type="Shader" path="res://assets/shaders/pixel_art_upscale.gdshader" id="5_ybrq6"]
[ext_resource type="Script" path="res://scripts/display2.gd" id="6_7ti74"]
[ext_resource type="FontFile" uid="uid://cshtjebbbu45b" path="res://assets/fonts/ark-pixel-12px-monospaced-zh_cn.otf" id="9_pgmli"]

[sub_resource type="Animation" id="Animation_wjea1"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:light_energy")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [1.0]
}

[sub_resource type="Animation" id="Animation_2devf"]
resource_name = "flicker"
length = 5.0
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:light_energy")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.1, 1.2, 1.3, 1.6, 1.7, 1.9),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [1.0, 1.0, 0.764, 1.0, 1.0, 0.745, 1.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_d1h1v"]
_data = {
"RESET": SubResource("Animation_wjea1"),
"flicker": SubResource("Animation_2devf")
}

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_13x8q"]
sky_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)
ground_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)

[sub_resource type="Sky" id="Sky_n1bhg"]
sky_material = SubResource("ProceduralSkyMaterial_13x8q")

[sub_resource type="Environment" id="Environment_n8rq2"]
background_mode = 1
sky = SubResource("Sky_n1bhg")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="ShaderMaterial" id="ShaderMaterial_vaet3"]
render_priority = 0
shader = ExtResource("4_oux1c")
shader_parameter/shadows_enabled = true
shader_parameter/highlights_enabled = false
shader_parameter/shadow_strength = 0.4
shader_parameter/highlight_strength = 0.1
shader_parameter/highlight_color = Color(1, 1, 1, 1)
shader_parameter/shadow_color = Color(0, 0, 0, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_lkgup"]
material = SubResource("ShaderMaterial_vaet3")
size = Vector2(10, 8)

[sub_resource type="LabelSettings" id="LabelSettings_lllcc"]
font = ExtResource("9_pgmli")
font_size = 24
font_color = Color(1, 1, 1, 0.772549)
outline_size = 4
outline_color = Color(0, 0, 0, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_sdyh0"]
shader = ExtResource("5_ybrq6")

[sub_resource type="ViewportTexture" id="ViewportTexture_72lo0"]
viewport_path = NodePath("SubViewport")

[node name="world" type="Node3D"]

[node name="map" type="Node3D" parent="."]

[node name="wall&floor" type="Node" parent="map"]

[node name="floor" type="CSGBox3D" parent="map/wall&floor"]
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(10, 1, 10)

[node name="floor4" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 15, 0, -18)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(10, 1, 10)

[node name="floor2" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -12)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(2, 1, 14)

[node name="floor3" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.5, 0, -18)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(9, 1, 2)

[node name="wall1" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.5, 1.5, 0)
visible = false
layers = 2
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall2" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5.5, 1.5, 0)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall6" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.5, 1.5, -15)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall13" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 20.5, 1.5, -18)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall12" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.5, 1.5, -21.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 3)

[node name="wall10" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.5, 1.5, -12.5)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall11" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.5, 1.5, -23.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall8" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.5, 1.5, -19.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall3" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 0, 1.5, 5.5)
visible = false
layers = 2
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall4" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -3, 1.5, -5.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall7" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -1.5, 1.5, -13)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(14, 4, 1)

[node name="wall5" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 3, 1.5, -5.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall9" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 5, 1.5, -11.5)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 8)

[node name="OmniLight3D" type="OmniLight3D" parent="map"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3.48807, 0)
layers = 3
shadow_enabled = true
omni_range = 8.81565

[node name="AnimationPlayer" type="AnimationPlayer" parent="map/OmniLight3D"]
libraries = {
"": SubResource("AnimationLibrary_d1h1v")
}
autoplay = "flicker"

[node name="WorldEnvironment" type="WorldEnvironment" parent="map"]
environment = SubResource("Environment_n8rq2")

[node name="SubViewport" type="SubViewport" parent="."]
handle_input_locally = false
size = Vector2i(484, 272)

[node name="player" parent="SubViewport" node_paths=PackedStringArray("camera_rig", "camera") instance=ExtResource("3_b20om")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
camera_rig = NodePath("../camera_rig")
camera = NodePath("../camera_rig/Camera3D")

[node name="visuals" parent="SubViewport/player" index="1" groups=["snap"]]

[node name="Skeleton3D" parent="SubViewport/player/visuals/female/Armature" index="0"]
bones/0/position = Vector3(5.31493, 0.99906, -103.199)
bones/0/rotation = Quaternion(-0.706944, -0.0557515, 0.0141254, 0.704927)
bones/1/rotation = Quaternion(-0.0703423, 0.00231868, 0.0157536, 0.997396)
bones/2/rotation = Quaternion(0.0196368, 0.00256698, 0.027663, 0.999421)
bones/3/rotation = Quaternion(0.0325134, 0.00292319, 0.0276275, 0.999085)
bones/4/rotation = Quaternion(-0.0929064, -0.0014767, 0.00693767, 0.99565)
bones/5/rotation = Quaternion(0.0309999, 0.0146823, -0.0474487, 0.998285)
bones/7/rotation = Quaternion(-0.53952, 0.529161, -0.546218, -0.361322)
bones/8/position = Vector3(-1.04733e-06, 10.8382, -3.12109e-05)
bones/8/rotation = Quaternion(0.484089, -0.302008, -0.183179, 0.800559)
bones/9/position = Vector3(6.66651e-06, 27.8415, -7.76033e-06)
bones/9/rotation = Quaternion(0.000313802, 0.00207469, -0.149683, 0.988732)
bones/10/position = Vector3(2.35774e-05, 28.3288, 7.24165e-07)
bones/10/rotation = Quaternion(-0.206203, 0.259368, -0.0816884, 0.939966)
bones/11/position = Vector3(2.68185, 2.46481, 1.57399)
bones/11/rotation = Quaternion(0.201767, 0.149035, -0.104799, 0.962339)
bones/12/position = Vector3(1.90735e-06, 4.18899, 7.11515e-06)
bones/12/rotation = Quaternion(-0.0389447, -0.00928359, 0.129819, 0.990729)
bones/13/rotation = Quaternion(4.61435e-07, -0.000807556, 3.13501e-07, 1)
bones/14/position = Vector3(8.34465e-07, 2.57497, 2.44224e-07)
bones/15/position = Vector3(2.25983, 9.10827, 0.517858)
bones/15/rotation = Quaternion(0.177851, 0.0678935, 0.0607458, 0.979831)
bones/16/position = Vector3(2.91133e-07, 3.69999, 5.62467e-07)
bones/16/rotation = Quaternion(0.10499, 2.10362e-05, 0.00781617, 0.994443)
bones/17/position = Vector3(-6.47087e-08, 2.85001, 2.05763e-07)
bones/17/rotation = Quaternion(8.10558e-06, -1.61364e-07, 6.33008e-08, 1)
bones/18/position = Vector3(-4.47108e-08, 2.77219, -5.25441e-06)
bones/19/position = Vector3(-2.18916e-05, 9.53249, 3.43381e-05)
bones/19/rotation = Quaternion(0.17545, 0.0105992, 0.0492441, 0.983199)
bones/20/position = Vector3(-1.13552e-06, 3.70001, 1.49899e-06)
bones/20/rotation = Quaternion(0.146748, 0.000539506, -0.00779205, 0.989143)
bones/21/position = Vector3(-4.02008e-07, 2.95, -5.42922e-06)
bones/21/rotation = Quaternion(2.58754e-06, -1.5214e-07, 5.64614e-08, 1)
bones/22/position = Vector3(-4.01207e-07, 2.94664, 1.32651e-06)
bones/23/position = Vector3(-1.86514, 9.1036, 0.043061)
bones/23/rotation = Quaternion(0.219456, 0.0131635, 0.0303616, 0.975061)
bones/24/position = Vector3(2.58176e-07, 3.37928, -9.78343e-07)
bones/24/rotation = Quaternion(0.124752, 0.00284668, -0.00708033, 0.992159)
bones/25/position = Vector3(-1.53406e-07, 2.88968, -1.774e-06)
bones/25/rotation = Quaternion(2.64022e-06, -4.05355e-08, -1.73248e-07, 1)
bones/26/position = Vector3(-2.81072e-07, 2.6388, 3.11877e-07)
bones/27/position = Vector3(-3.80628, 8.07666, 0.486695)
bones/27/rotation = Quaternion(0.225376, -0.00464432, 0.0332324, 0.973694)
bones/28/position = Vector3(-3.01202e-08, 3.6, -2.13743e-06)
bones/28/rotation = Quaternion(0.140123, 0.00650426, -0.0400758, 0.989301)
bones/29/position = Vector3(1.63284e-06, 2.09997, -3.23089e-08)
bones/29/rotation = Quaternion(3.57677e-06, -2.75607e-07, -4.79631e-07, 1)
bones/30/position = Vector3(-1.17017e-06, 2.11577, -4.388e-06)
bones/31/rotation = Quaternion(0.568849, 0.503646, -0.538729, 0.364037)
bones/32/position = Vector3(2.54742e-06, 10.8377, 2.18272e-06)
bones/32/rotation = Quaternion(0.504688, 0.221292, 0.203703, 0.809212)
bones/33/position = Vector3(6.28457e-07, 27.8415, 6.22588e-06)
bones/33/rotation = Quaternion(0.000279326, -0.0023337, 0.118727, 0.992924)
bones/34/position = Vector3(6.12936e-06, 28.3288, 6.23057e-06)
bones/34/rotation = Quaternion(-0.100067, -0.146662, 0.133028, 0.97508)
bones/35/position = Vector3(-2.68173, 2.46613, 1.5762)
bones/35/rotation = Quaternion(0.21738, -0.117753, 0.119661, 0.961541)
bones/36/position = Vector3(-1.54972e-06, 4.1871, -8.58006e-06)
bones/36/rotation = Quaternion(-0.0486588, 0.0175979, -0.0928337, 0.994336)
bones/37/position = Vector3(-8.22544e-06, 3.41839, 3.48625e-06)
bones/37/rotation = Quaternion(5.88579e-07, 0.000745094, -1.38799e-07, 1)
bones/38/position = Vector3(-3.24845e-06, 2.58058, -2.40185e-05)
bones/39/position = Vector3(-2.25986, 9.10929, 0.518037)
bones/39/rotation = Quaternion(0.118506, -0.0682973, -0.0984794, 0.985695)
bones/40/position = Vector3(-1.5316e-06, 3.7, 4.314e-06)
bones/40/rotation = Quaternion(0.0996495, 0.00382746, -0.0101642, 0.994963)
bones/41/position = Vector3(2.29265e-07, 2.85002, -8.06856e-06)
bones/41/rotation = Quaternion(7.62116e-08, -1.15326e-07, -1.10886e-08, 1)
bones/42/position = Vector3(1.26154e-07, 2.77487, 9.03976e-06)
bones/43/position = Vector3(-3.79958e-05, 9.53338, -2.97961e-05)
bones/43/rotation = Quaternion(0.0932661, -0.0125891, -0.0592809, 0.993795)
bones/44/position = Vector3(2.93684e-07, 3.70001, -7.33839e-07)
bones/44/rotation = Quaternion(0.091362, 9.28344e-05, 0.0026143, 0.995814)
bones/45/position = Vector3(-7.89749e-07, 2.95, 5.37346e-06)
bones/45/rotation = Quaternion(-2.58437e-06, -2.37944e-07, -4.2887e-07, 1)
bones/46/position = Vector3(-3.41319e-07, 2.95288, -2.20348e-06)
bones/47/position = Vector3(1.86508, 9.10452, 0.0430273)
bones/47/rotation = Quaternion(0.166785, 0.0069787, -0.059058, 0.984198)
bones/48/position = Vector3(1.21889e-06, 3.15002, 2.89108e-07)
bones/48/rotation = Quaternion(0.0916319, -0.000958372, -0.000830116, 0.995792)
bones/49/position = Vector3(-1.23848e-07, 2.95, -5.32404e-06)
bones/49/rotation = Quaternion(-2.58624e-06, -3.96691e-07, -3.96689e-07, 1)
bones/50/position = Vector3(-2.33936e-05, 2.64433, 1.24642e-05)
bones/51/position = Vector3(3.80626, 8.07777, 0.486884)
bones/51/rotation = Quaternion(0.261075, 0.0394505, -0.070126, 0.961959)
bones/52/position = Vector3(2.40696e-06, 3.59999, 3.48082e-08)
bones/52/rotation = Quaternion(0.160047, -0.000824096, 0.0280396, 0.986711)
bones/53/position = Vector3(1.07736e-06, 2.10001, -3.70327e-06)
bones/53/rotation = Quaternion(7.27448e-06, 5.25845e-07, 5.37373e-07, 1)
bones/54/position = Vector3(-5.55534e-07, 2.12552, -8.40792e-06)
bones/55/rotation = Quaternion(-0.0609614, 0.031632, 0.995936, -0.0582566)
bones/56/rotation = Quaternion(-0.109988, -0.000193378, 0.00207823, 0.993931)
bones/57/rotation = Quaternion(0.49386, 0.0814113, -0.0652985, 0.863256)
bones/58/rotation = Quaternion(0.357823, -0.00780368, 0.00607017, 0.933737)
bones/60/rotation = Quaternion(0.0234704, 0.137503, 0.987268, -0.0764429)
bones/61/rotation = Quaternion(-0.166862, -0.000878965, -0.00482675, 0.985968)
bones/62/rotation = Quaternion(0.428887, -0.162568, 0.0424211, 0.887597)
bones/63/rotation = Quaternion(0.33427, -0.0206335, 0.019287, 0.942054)

[node name="Beta_Joints" parent="SubViewport/player/visuals/female/Armature/Skeleton3D" index="0"]
layers = 3

[node name="Beta_Surface" parent="SubViewport/player/visuals/female/Armature/Skeleton3D" index="1"]
layers = 3

[node name="AnimationPlayer" parent="SubViewport/player/visuals/female" index="1"]
autoplay = "idle"

[node name="OmniLight3D" type="OmniLight3D" parent="SubViewport/player/visuals" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.8, -0.5)
visible = false
layers = 2
light_energy = 0.2
light_cull_mask = 4293918722
omni_range = 1.0
script = ExtResource("4_8vwj6")

[node name="SpotLight3D" type="SpotLight3D" parent="SubViewport/player/visuals" index="2"]
transform = Transform3D(1, 0, 0, 0, 0.866025, 0.5, 0, -0.5, 0.866025, 0, 1.9, -0.2)
visible = false
spot_angle = 32.9
script = ExtResource("4_8vwj6")

[node name="AnimationTree" parent="SubViewport/player/visuals" index="3"]
parameters/aim_walk/blend_position = Vector2(-0.482292, -0.29199)
parameters/crouch_walk/TimeScale/scale = 0.7

[node name="camera_rig" type="Node3D" parent="SubViewport" node_paths=PackedStringArray("player")]
transform = Transform3D(0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 0, 1.7, 0)
script = ExtResource("4_7t8jk")
player = NodePath("../player")

[node name="Camera3D" type="Camera3D" parent="SubViewport/camera_rig"]
transform = Transform3D(1, 0, 0, 0, 0.707107, 0.707107, 0, -0.707107, 0.707106, 0, 6, 5)
projection = 1
current = true
size = 5.355
script = ExtResource("4_cgcpi")

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewport/camera_rig/Camera3D"]
transform = Transform3D(1, 0, 0, 0, -5.96046e-08, -1, 0, 1, 0, 9.53674e-07, -0.255379, -0.976128)
mesh = SubResource("PlaneMesh_lkgup")
skeleton = NodePath("../..")

[node name="Display" type="Control" parent="." node_paths=PackedStringArray("viewport")]
clip_contents = true
layout_mode = 3
anchor_right = 0.688
anchor_bottom = 0.704
offset_right = 599.04
offset_bottom = 319.68
script = ExtResource("6_7ti74")
viewport = NodePath("../SubViewport")

[node name="Label" type="Label" parent="Display"]
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -83.0
offset_top = -34.0
offset_right = 83.0
grow_horizontal = 2
grow_vertical = 0
text = "[WASD]-移动  [Q/E]-转动视角  [SHIFT]-冲刺  [空格]-开关手电  [C]-蹲下  [鼠标右键]-瞄准"
label_settings = SubResource("LabelSettings_lllcc")

[node name="Sprite2D" type="Sprite2D" parent="Display"]
z_index = -1
texture_filter = 2
material = SubResource("ShaderMaterial_sdyh0")
texture = SubResource("ViewportTexture_72lo0")
centered = false

[editable path="SubViewport/player"]
[editable path="SubViewport/player/visuals/female"]
