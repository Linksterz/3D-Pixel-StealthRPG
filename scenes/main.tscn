[gd_scene load_steps=22 format=3 uid="uid://ci6hsk3tl8qw6"]

[ext_resource type="Material" uid="uid://cpfv4dtvrm85w" path="res://assets/materials/floor_mat.tres" id="1_ebtfw"]
[ext_resource type="Material" uid="uid://bcaksjnqmlidl" path="res://assets/materials/wall_mat.tres" id="2_x3icv"]
[ext_resource type="PackedScene" uid="uid://wu130723yj4r" path="res://scenes/player/player.tscn" id="3_b20om"]
[ext_resource type="Script" path="res://scripts/camera_rig.gd" id="4_7t8jk"]
[ext_resource type="Script" path="res://scripts/player/headlight_togle.gd" id="4_8vwj6"]
[ext_resource type="Script" path="res://scripts/camera_3d_texel_snapped3.gd" id="4_cgcpi"]
[ext_resource type="Shader" path="res://assets/shaders/pixelart_stylizer.gdshader" id="4_oux1c"]
[ext_resource type="Shader" path="res://assets/shaders/pixel_art_upscale.gdshader" id="5_ybrq6"]
[ext_resource type="Script" path="res://scripts/display2.gd" id="6_7ti74"]
[ext_resource type="FontFile" uid="uid://cshtjebbbu45b" path="res://assets/fonts/ark-pixel-12px-monospaced-zh_cn.otf" id="9_pgmli"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_13x8q"]
sky_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)
ground_horizon_color = Color(0.64625, 0.65575, 0.67075, 1)

[sub_resource type="Sky" id="Sky_n1bhg"]
sky_material = SubResource("ProceduralSkyMaterial_13x8q")

[sub_resource type="Environment" id="Environment_n8rq2"]
background_mode = 1
sky = SubResource("Sky_n1bhg")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="Animation" id="Animation_wjea1"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:light_energy")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [1.0]
}

[sub_resource type="Animation" id="Animation_2devf"]
resource_name = "flicker"
length = 5.0
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:light_energy")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.1, 1.2, 1.3, 1.6, 1.7, 1.9),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [1.0, 1.0, 0.764, 1.0, 1.0, 0.745, 1.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_d1h1v"]
_data = {
"RESET": SubResource("Animation_wjea1"),
"flicker": SubResource("Animation_2devf")
}

[sub_resource type="ShaderMaterial" id="ShaderMaterial_vaet3"]
render_priority = 0
shader = ExtResource("4_oux1c")
shader_parameter/shadows_enabled = true
shader_parameter/highlights_enabled = false
shader_parameter/shadow_strength = 0.4
shader_parameter/highlight_strength = 0.1
shader_parameter/highlight_color = Color(1, 1, 1, 1)
shader_parameter/shadow_color = Color(0, 0, 0, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_lkgup"]
material = SubResource("ShaderMaterial_vaet3")
size = Vector2(10, 8)

[sub_resource type="LabelSettings" id="LabelSettings_lllcc"]
font = ExtResource("9_pgmli")
font_size = 24
font_color = Color(1, 1, 1, 0.772549)
outline_size = 4
outline_color = Color(0, 0, 0, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_sdyh0"]
shader = ExtResource("5_ybrq6")

[sub_resource type="ViewportTexture" id="ViewportTexture_72lo0"]
viewport_path = NodePath("SubViewport")

[node name="world" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_n8rq2")

[node name="map" type="Node3D" parent="."]

[node name="wall&floor" type="Node" parent="map"]

[node name="floor" type="CSGBox3D" parent="map/wall&floor"]
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(10, 1, 10)

[node name="floor4" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 15, 0, -18)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(10, 1, 10)

[node name="floor2" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -12)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(2, 1, 14)

[node name="floor3" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.5, 0, -18)
material_override = ExtResource("1_ebtfw")
use_collision = true
size = Vector3(9, 1, 2)

[node name="wall1" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.5, 1.5, 0)
visible = false
layers = 2
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall2" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5.5, 1.5, 0)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall6" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.5, 1.5, -15)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall13" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 20.5, 1.5, -18)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall12" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 9.5, 1.5, -21.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 3)

[node name="wall10" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.5, 1.5, -12.5)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall11" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.5, 1.5, -23.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall8" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.5, 1.5, -19.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 1)

[node name="wall3" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 0, 1.5, 5.5)
visible = false
layers = 2
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 10)

[node name="wall4" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -3.5, 1.5, -5.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 5)

[node name="wall7" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -1.5, 1.5, -13)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(14, 4, 1)

[node name="wall5" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 3, 1.5, -5.5)
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(1, 4, 4)

[node name="wall9" type="CSGBox3D" parent="map/wall&floor"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 5, 1.5, -11.5)
visible = false
material_override = ExtResource("2_x3icv")
use_collision = true
size = Vector3(11, 4, 8)

[node name="OmniLight3D" type="OmniLight3D" parent="map"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3.48807, 0)
layers = 3
shadow_enabled = true
omni_range = 8.81565

[node name="AnimationPlayer" type="AnimationPlayer" parent="map/OmniLight3D"]
libraries = {
"": SubResource("AnimationLibrary_d1h1v")
}
autoplay = "flicker"

[node name="SubViewport" type="SubViewport" parent="."]
handle_input_locally = false
size = Vector2i(484, 272)

[node name="player" parent="SubViewport" node_paths=PackedStringArray("camera_rig", "camera") instance=ExtResource("3_b20om")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
camera_rig = NodePath("../camera_rig")
camera = NodePath("../camera_rig/Camera3D")

[node name="visuals" parent="SubViewport/player" index="1" groups=["snap"]]

[node name="female" parent="SubViewport/player/visuals" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0)

[node name="Skeleton3D" parent="SubViewport/player/visuals/female/Armature" index="0"]
bones/0/position = Vector3(0.279614, 2.50038, -95.1087)
bones/0/rotation = Quaternion(-0.618466, -0.285911, 0.244711, 0.689834)
bones/1/rotation = Quaternion(-0.0613479, 0.0523511, 0.0334728, 0.99618)
bones/2/rotation = Quaternion(0.0181918, 0.0271045, 0.00246612, 0.999464)
bones/3/rotation = Quaternion(0.0309098, 0.00380158, 0.0187991, 0.999338)
bones/4/rotation = Quaternion(0.104915, 0.0677631, -0.0279855, 0.991775)
bones/5/rotation = Quaternion(0.00991829, 0.17373, 0.0855013, 0.981025)
bones/7/rotation = Quaternion(-0.420713, 0.504381, -0.558799, -0.506304)
bones/8/rotation = Quaternion(0.364979, 0.102254, -0.818914, 0.430946)
bones/9/rotation = Quaternion(4.16832e-08, -7.2289e-08, -0.260542, 0.965462)
bones/10/rotation = Quaternion(-0.222724, 0.37587, 0.173462, 0.882625)
bones/31/rotation = Quaternion(0.509861, 0.561436, -0.577684, 0.301849)
bones/32/rotation = Quaternion(0.262605, -0.254271, 0.500685, 0.784665)
bones/33/rotation = Quaternion(3.7836e-07, -4.14087e-07, 0.662289, 0.749249)
bones/34/rotation = Quaternion(-0.184992, -0.388013, -0.34051, 0.836228)
bones/55/rotation = Quaternion(-0.0874803, 0.163069, 0.980943, 0.0592207)
bones/56/rotation = Quaternion(-0.330917, -0.0577687, -0.0154265, 0.941764)
bones/57/rotation = Quaternion(0.588051, 0.0932885, 0.0715685, 0.800232)
bones/58/rotation = Quaternion(0.345626, -1.78297e-08, -9.14438e-08, 0.938372)
bones/60/rotation = Quaternion(0.081755, 0.308956, 0.932757, -0.166816)
bones/61/rotation = Quaternion(-0.25653, -0.059637, 0.0392666, 0.963895)
bones/62/rotation = Quaternion(0.453286, -0.0545823, -0.0579654, 0.887802)
bones/63/rotation = Quaternion(0.336735, -0.00079045, -0.000286349, 0.941599)

[node name="Beta_Joints" parent="SubViewport/player/visuals/female/Armature/Skeleton3D" index="0"]
layers = 3

[node name="Beta_Surface" parent="SubViewport/player/visuals/female/Armature/Skeleton3D" index="1"]
layers = 3

[node name="AnimationPlayer" parent="SubViewport/player/visuals/female" index="1"]
autoplay = "idle"

[node name="OmniLight3D" type="OmniLight3D" parent="SubViewport/player/visuals" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.8, -0.5)
visible = false
layers = 2
light_energy = 0.2
light_cull_mask = 4293918722
omni_range = 1.0
script = ExtResource("4_8vwj6")

[node name="SpotLight3D" type="SpotLight3D" parent="SubViewport/player/visuals" index="2"]
transform = Transform3D(1, 0, 0, 0, 0.866025, 0.5, 0, -0.5, 0.866025, 0, 1.9, -0.2)
visible = false
spot_angle = 32.9
script = ExtResource("4_8vwj6")

[node name="AnimationTree" parent="SubViewport/player/visuals" index="3"]
parameters/aim_walk/blend_position = Vector2(-0.482292, -0.29199)

[node name="camera_rig" type="Node3D" parent="SubViewport" node_paths=PackedStringArray("player")]
transform = Transform3D(0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 0, 1.7, 0)
script = ExtResource("4_7t8jk")
player = NodePath("../player")

[node name="Camera3D" type="Camera3D" parent="SubViewport/camera_rig"]
transform = Transform3D(1, 0, 0, 0, 0.707107, 0.707107, 0, -0.707107, 0.707106, 0, 6, 5)
projection = 1
current = true
size = 5.355
script = ExtResource("4_cgcpi")

[node name="MeshInstance3D" type="MeshInstance3D" parent="SubViewport/camera_rig/Camera3D"]
transform = Transform3D(1, 0, 0, 0, -5.96046e-08, -1, 0, 1, 0, 9.53674e-07, -0.255379, -0.976128)
mesh = SubResource("PlaneMesh_lkgup")
skeleton = NodePath("../..")

[node name="Display" type="Control" parent="." node_paths=PackedStringArray("viewport")]
clip_contents = true
layout_mode = 3
anchor_right = 0.688
anchor_bottom = 0.704
offset_right = 599.04
offset_bottom = 319.68
script = ExtResource("6_7ti74")
viewport = NodePath("../SubViewport")

[node name="Label" type="Label" parent="Display"]
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -83.0
offset_top = -34.0
offset_right = 83.0
grow_horizontal = 2
grow_vertical = 0
text = "[WASD]-移动  [SHIFT]-冲刺  [空格]-开关手电  [鼠标右键]-瞄准"
label_settings = SubResource("LabelSettings_lllcc")

[node name="Sprite2D" type="Sprite2D" parent="Display"]
z_index = -1
texture_filter = 2
material = SubResource("ShaderMaterial_sdyh0")
texture = SubResource("ViewportTexture_72lo0")
centered = false

[editable path="SubViewport/player"]
[editable path="SubViewport/player/visuals/female"]
